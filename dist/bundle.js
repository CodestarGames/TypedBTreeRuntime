var TypedBTree=function(t){var e={};function i(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(o,s,function(e){return t[e]}.bind(null,s));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0,e.State={READY:Symbol("typedBTree.ready"),RUNNING:Symbol("typedBTree.running"),SUCCEEDED:Symbol("typedBTree.succeeded"),FAILED:Symbol("typedBTree.failed")}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(5)),r=i(0);class a extends s.default{constructor(t,e,i){super(t,e),this._children=i}onUpdate(t){throw new Error("Method not implemented.")}getChildren(){return this._children}abort(t){if(!this.is(r.State.RUNNING))return;this.getChildren().forEach(e=>e.abort(t)),this.reset();const e=this.getDecorator("exit");e&&e.callBlackboardFunction(t,!1,!0)}reset(){this.setState(r.State.READY),this.getChildren().forEach(t=>t.reset())}isLeafNode(){return!1}getName(){}}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.getType=()=>this.constructor.name,this.isGuard=()=>!1,this.getDetails=()=>({type:this.getType()})}}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(5));class r extends s.default{constructor(t,e){super(t,e)}isLeafNode(){return!0}onUpdate(t){}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class o extends Error{constructor(t){super(o.message),this.isSourceNode=t=>t===this.source,this.source=t}}e.default=o,o.message="A guard path condition has failed"},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.createNodeUid=void 0;const s=o(i(4)),r=i(0);function a(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}e.default=class{constructor(t,e){this.uid=a(),this.state=r.State.READY,this.guardPath=null,this._type=t,this._decorators=e}getDecorators(){return this._decorators||[]}getDecorator(t){return this.getDecorators().filter(e=>e.getType().toUpperCase()===t.toUpperCase())[0]||null}update(t){if(!this.is(r.State.SUCCEEDED)&&!this.is(r.State.FAILED))try{if(this.guardPath.evaluate(t),this.is(r.State.READY)){const e=this.getDecorator("entry");e&&e.callBlackboardFunction(t)}const e=this.getDecorator("step");if(e&&e.callBlackboardFunction(t),this.onUpdate(t),this.is(r.State.SUCCEEDED)||this.is(r.State.FAILED)){const e=this.getDecorator("exit");e&&e.callBlackboardFunction(t,this.is(r.State.SUCCEEDED),!1)}}catch(e){if(!(e instanceof s.default&&e.isSourceNode(this)))throw e;this.abort(t),this.setState(r.State.FAILED)}}is(t){return this.state===t}hasGuardPath(){return!!this.guardPath}getUid(){return this.uid}getState(){switch(this.state.toString()){case"Symbol(typedBTree.running)":return r.State.RUNNING;case"Symbol(typedBTree.succeeded)":return r.State.SUCCEEDED;case"Symbol(typedBTree.failed)":return r.State.FAILED;default:return r.State.RUNNING}}getStateAsString(){return(t=>{switch(t){case r.State.RUNNING:return"running";case r.State.SUCCEEDED:return"succeeded";case r.State.FAILED:return"failed";default:return"ready"}})(this.state)}getType(){return this._type}abort(t){if(!this.is(r.State.RUNNING))return;this.reset();const e=this.getDecorator("exit");e&&e.callBlackboardFunction(t,!1,!0)}setGuardPath(t){return this.guardPath=t}setState(t){switch(t.toString()){case"Symbol(typedBTree.running)":return this.state=r.State.RUNNING;case"Symbol(typedBTree.succeeded)":return this.state=r.State.SUCCEEDED;case"Symbol(typedBTree.failed)":return this.state=r.State.FAILED;default:return this.state=r.State.RUNNING}}reset(){this.setState(r.State.READY)}getGuardDecorators(){return this.getDecorators().filter(t=>t.isGuard())}},e.createNodeUid=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.State=e.BehaviourTree=void 0;const s=o(i(7));e.BehaviourTree=s.default;const r=i(0);Object.defineProperty(e,"State",{enumerable:!0,get:function(){return r.State}}),globalThis.TypedBTree={BehaviourTree:s.default,State:r.State}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(8),r=i(0),a=o(i(1)),n=i(9);e.default=class{constructor(t,e){this._blackboard=e,this._init(t,e)}get rootNode(){return this._rootNode}_init(t,e){if("string"!=typeof t)throw new Error("the tree definition must be a string");if("object"!=typeof e||null===e)throw new Error("the blackboard must be defined");try{this.rootASTNodes=(new n.RootNodesBuilder).TraverseContent([JSON.parse(t)]);const e=Symbol("__root__");this.rootNodeMap={};for(const t of this.rootASTNodes)this.rootNodeMap[null===t.name?e:t.name]=t;const i=t=>this.rootNodeMap[t];this._rootNode=this.rootNodeMap[e].createNodeInstance(i,[]),this._applyLeafNodeGuardPaths()}catch(t){throw new Error("error parsing tree: "+t)}}_parseTokensFromDefinition(t){let e=t;return e=e.replace(/\(/g," ( "),e=e.replace(/\)/g," ) "),e=e.replace(/\{/g," { "),e=e.replace(/\}/g," } "),e=e.replace(/\]/g," ] "),e=e.replace(/\[/g," [ "),e=e.replace(/\,/g," , "),e.replace(/\s+/g," ").trim().split(" ")}_applyLeafNodeGuardPaths(){this._getAllNodePaths().forEach(t=>{for(let e=0;e<t.length;e++){const i=t[e];if(i.hasGuardPath())continue;const o=new s.GuardPath(t.slice(0,e+1).map(t=>({node:t,guards:t.getGuardDecorators()})).filter(t=>t.guards.length>0));i.setGuardPath(o)}})}_getAllNodePaths(){const t=new Array,e=(i,o)=>{i=i.concat(o),o.isLeafNode()?t.push(i):o.getChildren().forEach(t=>e(i,t))};return e([],this._rootNode),t}getRootNode(){return this._rootNode}getFlattenedNodeDetails(){const t=new Array,e=(i,o)=>{var s;t.push({id:i.getUid(),type:i.getType(),caption:i.getName(),state:i.getState(),decorators:(s=i.getDecorators(),s.length>0?s.map(t=>t.getDetails()):null),parentId:o}),i instanceof a.default&&(i.isLeafNode()||i.getChildren().forEach(t=>e(t,i.getUid())))};return e(this._rootNode,null),t}isRunning(){return this._rootNode.getState()===r.State.RUNNING}getState(){return this._rootNode.getState()}step(){this._rootNode.getState()!==r.State.SUCCEEDED&&this._rootNode.getState()!==r.State.FAILED||this._rootNode.reset();try{this._rootNode.update(this._blackboard)}catch(t){throw new Error("error stepping tree: "+t)}}reset(){this._rootNode.reset()}}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.GuardPath=void 0;const s=o(i(4));e.GuardPath=class{constructor(t){this.nodes=t}evaluate(t){for(const e of this.nodes)for(const i of e.guards)if(!i.isSatisfied(t))throw new s.default(e.node)}}},function(t,e,i){"use strict";var o=this&&this.__rest||function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(t);s<o.length;s++)e.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(t,o[s])&&(i[o[s]]=t[o[s]])}return i};Object.defineProperty(e,"__esModule",{value:!0}),e.RootNodesBuilder=void 0;const s=i(10);e.RootNodesBuilder=class{constructor(){this.stack=[[]]}TraverseContent(t){return t.forEach((t,e,i)=>{let r;if("$$.Root"===t.$type)return r=s.ASTNodeFactories.ROOT(),this.stack[this.stack.length-1].push(r),this.stack.push(r.children),r.decorators=this.getDecorators(t.hooks),void(t.children&&(this.TraverseContent([t.children]),this.stack.pop()));if("$$.Selector"===t.$type)return r=s.ASTNodeFactories.SELECTOR(),this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if("$$.Sequence"===t.$type)return r=s.ASTNodeFactories.SEQUENCE(),this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if("$$.Repeat"===t.$type)return r=s.ASTNodeFactories.REPEAT(),r.iterations=t["$data.times"],this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if("$$.Lotto"===t.$type)return r=s.ASTNodeFactories.LOTTO(),r.props={tickets:t["$data.tickets"]},this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if("$$.Flip"===t.$type)return r=s.ASTNodeFactories.FLIP(),this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if("$$.Parallel"===t.$type)return r=s.ASTNodeFactories.PARALLEL(),this.handleChildren(r,t),void(r.decorators=this.getDecorators(t.hooks));if(t.$type.indexOf("$$.Actions")>-1){r=s.ASTNodeFactories.ACTION(),this.stack[this.stack.length-1].push(r),r.actionName=t.$type;let{$type:e}=t,i=o(t,["$type"]);r.props=i,r.decorators=this.getDecorators(t.hooks)}t.$type.indexOf("$$.Condition")>-1&&(r=s.ASTNodeFactories.CONDITION(),this.stack[this.stack.length-1].push(r),r.conditionFunction=t.$condition,r.decorators=this.getDecorators(t.hooks)),t.$type.indexOf("$$.Wait")>-1&&(r=s.ASTNodeFactories.WAIT(),this.stack[this.stack.length-1].push(r),r.duration=t["$data.duration"],r.decorators=this.getDecorators(t.hooks))}),this.stack[0]}handleChildren(t,e){this.stack[this.stack.length-1].push(t),"object"==typeof e.children&&!1===Array.isArray(e.children)&&(e.children=[e.children]),this.stack.push(t.children),e.children&&e.children.length>0&&(this.TraverseContent(e.children),this.stack.pop())}getDecorators(t){let e=[];return t&&t.forEach(t=>{let i;switch(t.$type){case"$$.Hooks.Until":i=s.DecoratorFactories.UNTIL(t.$condition),e.push(i);break;case"$$.Hooks.While":i=s.DecoratorFactories.WHILE(t.$condition),e.push(i);break;case"$$.Hooks.Entry":var r=t.action,{$type:a}=r,n=o(r,["$type"]);i=s.DecoratorFactories.ENTRY(a,n),e.push(i);break;case"$$.Hooks.Step":var c=t.action,{$type:a}=c;n=o(c,["$type"]);i=s.DecoratorFactories.STEP(a,n),e.push(i);break;case"$$.Hooks.Exit":var d=t.action,{$type:a}=d;n=o(d,["$type"]);i=s.DecoratorFactories.EXIT(a,n),e.push(i)}}),e}}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ASTNodeFactories=e.DecoratorFactories=void 0;const s=o(i(11)),r=o(i(12)),a=o(i(13)),n=o(i(14)),c=o(i(15)),d=o(i(16)),h=o(i(17)),u=o(i(18)),l=o(i(19)),f=o(i(20)),p=o(i(21)),_=o(i(22)),S=o(i(23)),g=o(i(24)),N=o(i(25));e.DecoratorFactories={WHILE:t=>new p.default(t),UNTIL:t=>new _.default(t),ENTRY:(t,e)=>new S.default(t,e),EXIT:(t,e)=>new g.default(t,e),STEP:(t,e)=>new N.default(t,e)},e.ASTNodeFactories={ROOT:()=>({type:"root",decorators:[],name:null,children:[],validate:function(t){if(t>1)throw"a root node cannot be the child of another node";if(1!==this.children.length)throw"a root node must have a single child"},createNodeInstance:function(t,e){return new d.default(this.decorators,this.children[0].createNodeInstance(t,e.slice()))}}),BRANCH:()=>({type:"branch",props:{branchName:""},validate:function(t){},createNodeInstance:function(t,e){var i,o,s,r,a;const n=t(null===(i=this.props)||void 0===i?void 0:i.branchName);if(-1!==e.indexOf(null===(o=this.props)||void 0===o?void 0:o.branchName))throw`circular dependency found in branch node references for branch '${null===(s=this.props)||void 0===s?void 0:s.branchName}'`;if(n)return n.createNodeInstance(t,e.concat(null===(r=this.props)||void 0===r?void 0:r.branchName)).getChildren()[0];throw`branch references root node '${null===(a=this.props)||void 0===a?void 0:a.branchName}' which has not been defined`}}),SELECTOR:()=>({type:"selector",decorators:[],children:[],validate:function(t){if(this.children.length<1)throw"a selector node must have at least a single child"},createNodeInstance:function(t,e){return new h.default(this.decorators,this.children.map(i=>i.createNodeInstance(t,e.slice())))}}),SEQUENCE:()=>({type:"sequence",decorators:[],children:[],validate:function(t){if(this.children.length<1)throw"a sequence node must have at least a single child"},createNodeInstance:function(t,e){return new u.default(this.decorators,this.children.map(i=>i.createNodeInstance(t,e.slice())))}}),PARALLEL:()=>({type:"parallel",decorators:[],children:[],validate:function(t){if(this.children.length<1)throw"a parallel node must have at least a single child"},createNodeInstance:function(t,e){return new l.default(this.decorators,this.children.map(i=>i.createNodeInstance(t,e.slice())))}}),LOTTO:()=>({type:"lotto",decorators:[],children:[],props:{tickets:[]},validate:function(t){if(this.children.length<1)throw"a lotto node must have at least a single child"},createNodeInstance:function(t,e){var i;return new n.default(this.decorators,null===(i=this.props)||void 0===i?void 0:i.tickets,this.children.map(i=>i.createNodeInstance(t,e.slice())))}}),REPEAT:()=>({type:"repeat",decorators:[],iterations:null,maximumIterations:null,children:[],validate:function(t){if(1!==this.children.length)throw"a repeat node must have a single child";if(null!==this.iterations&&this.iterations<0&&(this.iterations=null),null!==this.maximumIterations){if(this.maximumIterations<0)throw"a repeat node must have a positive maximum iterations count if defined";if(this.iterations>this.maximumIterations)throw"a repeat node must not have an iteration count that exceeds the maximum iteration count"}},createNodeInstance:function(t,e){return new c.default(this.decorators,this.iterations,this.maximumIterations,this.children[0].createNodeInstance(t,e.slice()))}}),FLIP:()=>({type:"flip",decorators:[],children:[],validate:function(t){if(1!==this.children.length)throw"a flip node must have a single child"},createNodeInstance:function(t,e){return new a.default(this.decorators,this.children[0].createNodeInstance(t,e.slice()))}}),CONDITION:()=>({type:"condition",decorators:[],conditionFunction:"",validate:function(t){},createNodeInstance:function(t,e){return new r.default(this.decorators,this.conditionFunction)}}),WAIT:()=>({type:"wait",decorators:[],duration:null,longestDuration:null,validate:function(t){if(this.duration<0)throw"a wait node must have a positive duration";if(this.longestDuration){if(this.longestDuration<0)throw"a wait node must have a positive longest duration if one is defined";if(this.duration>this.longestDuration)throw"a wait node must not have a shortest duration that exceeds the longest duration"}},createNodeInstance:function(t,e){return new f.default(this.decorators,this.duration,this.longestDuration)}}),ACTION:()=>({type:"action",decorators:[],actionName:"",props:{},validate:function(t){},createNodeInstance:function(t,e){return new s.default(this.decorators,this.actionName,this.props)}})}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(3)),r=i(0);class a extends s.default{constructor(t,e,i){super("action",t);this._actionName=e,this._actionProps=i}toJSON(){return Object.assign(Object.assign({$type:this._actionName},this._actionProps),{state:this.getStateAsString()})}_validateUpdateResult(t){switch(t){case r.State.SUCCEEDED:case r.State.FAILED:case void 0:return;default:throw`action '${this._actionName}' 'onUpdate' returned an invalid response, expected an optional State.SUCCEEDED or State.FAILED value to be returned`}}getName(){return this._actionName}_validateAction(t){if(!t)throw`cannot update action node as action '${this._actionName}' is not defined in the blackboard`;if("function"!=typeof t)throw`action '${this._actionName}' must be a function`}reset(){this.setState(r.State.READY),this.isUsingUpdatePromise=!1,this.updatePromiseStateResult=null}onUpdate(t){this._ctx=t;const e=t[this._actionName];if(this.isUsingUpdatePromise)return void(this.updatePromiseStateResult&&this.setState(this.updatePromiseStateResult));let i;this._validateAction(e),i=this._actionProps?e.call(t,this._ctx,this._actionProps):e.call(t,this._ctx),i instanceof Promise?(i.then(t=>{if(this.isUsingUpdatePromise){if(t.toString()!==r.State.SUCCEEDED.toString()&&t.toString()!==r.State.FAILED.toString())throw"action node promise resolved with an invalid value, expected a State.SUCCEEDED or State.FAILED value to be returned";this.updatePromiseStateResult=t}},t=>{if(this.isUsingUpdatePromise)throw t}),this.setState(r.State.RUNNING),this.isUsingUpdatePromise=!0):(this._validateUpdateResult(i),this.setState(i||r.State.RUNNING))}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(3)),r=i(0);class a extends s.default{constructor(t,e){super("condition",t),this._condition=e}getName(){return this._condition}onUpdate(t){if("function"!=typeof t[this._condition])throw`cannot update condition node as function '${this._condition}' is not defined in the blackboard`;this.setState(t[this._condition].call(t,t)?r.State.SUCCEEDED:r.State.FAILED)}toJSON(){return{$type:"$$.Condition",$condition:this._condition,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e){super("flip",t,[e]),this._child=e}getName(){return"FLIP"}onUpdate(t){switch(this._child.getState()!==r.State.READY&&this._child.getState()!==r.State.RUNNING||this._child.update(t),this._child.getState()){case r.State.RUNNING:this.setState(r.State.RUNNING);break;case r.State.SUCCEEDED:this.setState(r.State.FAILED);break;case r.State.FAILED:this.setState(r.State.SUCCEEDED);break;default:this.setState(r.State.READY)}}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Flip",children:this._child,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e,i){super("lotto",t,i),this._tickets=e,this._children=i}getName(){return this._tickets.length?`LOTTO [${this._tickets.join(",")}]`:"LOTTO"}onUpdate(t){if(this.is(r.State.READY)){const t=new n;this._children.forEach((e,i)=>t.add(e,this._tickets[i]||1)),this.winningChild=t.draw()}this.winningChild.getState()!==r.State.READY&&this.winningChild.getState()!==r.State.RUNNING||this.winningChild.update(t),this.setState(this.winningChild.getState())}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Lotto","$data.tickets":this._tickets,children:this._children,state:this.getStateAsString()}}}e.default=a;class n{constructor(){this.participants=new Array}add(t,e){return this.participants.push({participant:t,tickets:e}),this}draw(){if(!this.participants.length)throw"cannot draw a lotto winner when there are no participants";const t=new Array;return this.participants.forEach(e=>{for(let i=0;i<e.tickets;i++)t.push(e.participant)}),this.getRandomItem(t)}getRandomItem(t){if(t.length)return t[Math.floor(Math.random()*t.length)]}}},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e,i,o){super("repeat",t,[o]),this.targetIterationCount=null,this.currentIterationCount=0,this._iterations=e,this._maximumIterations=i,this._child=o}getName(){return null!==this._iterations?"REPEAT "+(this._maximumIterations?this._iterations+"x-"+this._maximumIterations+"x":this._iterations+"x"):"REPEAT"}reset(){this.setState(r.State.READY),this.currentIterationCount=0,this._child.reset()}_canIterate(){return null===this.targetIterationCount||this.currentIterationCount<this.targetIterationCount}onUpdate(t){if(this.is(r.State.READY)&&(this._child.reset(),this._setTargetIterationCount()),this._canIterate()){if(this.setState(r.State.RUNNING),this._child.getState()===r.State.SUCCEEDED&&this._child.reset(),this._child.update(t),this._child.getState()===r.State.FAILED)return void this.setState(r.State.FAILED);this._child.getState()===r.State.SUCCEEDED&&(this.currentIterationCount+=1)}else this.setState(r.State.SUCCEEDED)}_setTargetIterationCount(){"number"==typeof this._iterations?this.targetIterationCount="number"==typeof this._maximumIterations?Math.floor(Math.random()*(this._maximumIterations-this._iterations+1)+this._iterations):this._iterations:this.targetIterationCount=null}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Repeat","$data.times":this._iterations,children:this._child,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e){super("root",t,[e]),this._child=e}getName(){return"ROOT"}onUpdate(t){this._child.getState()!==r.State.READY&&this._child.getState()!==r.State.RUNNING||this._child.update(t),this.setState(this._child.getState())}toJSON(){return{$type:"$$.Root",children:this._child,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e){super("selector",t,e),this._children=e}getName(){return"SELECTOR"}onUpdate(t){for(const e of this._children){if(e.getState()!==r.State.READY&&e.getState()!==r.State.RUNNING||e.update(t),e.getState()===r.State.SUCCEEDED)return void this.setState(r.State.SUCCEEDED);if(e.getState()!==r.State.FAILED){if(e.getState()===r.State.RUNNING)return void this.setState(r.State.RUNNING);throw"Error: child node was not in an expected state."}if(this._children.indexOf(e)===this._children.length-1)return void this.setState(r.State.FAILED)}}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Selector",children:this._children,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e){super("sequence",t,e),this._children=e}getName(){return"SEQUENCE"}onUpdate(t){for(const e of this._children){if(e.getState()!==r.State.READY&&e.getState()!==r.State.RUNNING||e.update(t),e.getState()!==r.State.SUCCEEDED){if(e.getState()===r.State.FAILED)return void this.setState(r.State.FAILED);if(e.getState()===r.State.RUNNING)return void this.setState(r.State.RUNNING);throw"Error: child node was not in an expected state."}if(this._children.indexOf(e)===this._children.length-1)return void this.setState(r.State.SUCCEEDED)}}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Sequence",children:this._children,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(1)),r=i(0);class a extends s.default{constructor(t,e){super("parallel",t,e),this._children=e}getName(){return"PARALLEL"}onUpdate(t){let e=0,i=!1;for(const o of this._children)if(o.getState()!==r.State.READY&&o.getState()!==r.State.RUNNING||o.update(t),o.getState()!==r.State.SUCCEEDED){if(o.getState()===r.State.FAILED){i=!0;break}if(o.getState()!==r.State.RUNNING)throw"Error: child node was not in an expected state."}else e++;if(i){this.setState(r.State.FAILED);for(const e of this._children)e.getState()===r.State.RUNNING&&e.abort(t)}else this.setState(e===this._children.length?r.State.SUCCEEDED:r.State.RUNNING)}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Parallel",children:this._children,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(3)),r=i(0);class a extends s.default{constructor(t,e,i){super("wait",t),this._duration=e,this._longestDuration=i}getName(){return"WAIT "+(this._longestDuration?this._duration+"ms-"+this._longestDuration+"ms":this._duration+"ms")}onUpdate(t){this.is(r.State.READY)&&(this.initialUpdateTime=(new Date).getTime(),this.waitDuration=this._longestDuration?Math.floor(Math.random()*(this._longestDuration-this._duration+1)+this._duration):this._duration,this.setState(r.State.RUNNING)),(new Date).getTime()>=this.initialUpdateTime+this.waitDuration&&this.setState(r.State.SUCCEEDED)}toJSON(){return{hooks:this.getDecorators(),$type:"$$.Wait","$data.duration":this._duration,state:this.getStateAsString()}}}e.default=a},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(2));class r extends s.default{constructor(t){super(),this.isGuard=()=>!0,this.getCondition=()=>this.condition,this.getDetails=()=>({type:this.getType(),isGuard:this.isGuard(),condition:this.getCondition()}),this.isSatisfied=t=>{if("function"==typeof t[this.condition])return!!t[this.condition].call(t,t);throw`cannot evaluate node guard as function '${this.condition}' is not defined in the blackboard`},this.condition=t}toJSON(){return{$type:"$$.Hooks.While",$condition:this.condition}}}e.default=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(2));class r extends s.default{constructor(t){super(),this.isGuard=()=>!0,this.getCondition=()=>this.condition,this.getDetails=()=>({type:this.getType(),isGuard:this.isGuard(),condition:this.getCondition()}),this.isSatisfied=t=>{if("function"==typeof t[this.condition])return!t[this.condition].call(t,t);throw`cannot evaluate node guard as function '${this.condition}' is not defined in the blackboard`},this.condition=t}toJSON(){return{$type:"$$.Hooks.Until",$condition:this.condition}}}e.default=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(2));class r extends s.default{constructor(t,e){super(),this.getFunctionName=()=>this.functionName,this.getDetails=()=>({type:this.getType(),isGuard:this.isGuard(),functionName:this.getFunctionName()}),this.callBlackboardFunction=t=>{if("function"!=typeof t[this.functionName])throw`cannot call entry decorator function '${this.functionName}' is not defined in the blackboard`;t[this.functionName].call(t,t,this._fnData)},this.functionName=t,this._fnData=e}toJSON(){return{$type:"$$.Hooks.Entry",action:this.getFunctionName()}}}e.default=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(2));class r extends s.default{constructor(t,e){super(),this.getFunctionName=()=>this.functionName,this.getDetails=()=>({type:this.getType(),isGuard:this.isGuard(),functionName:this.getFunctionName()}),this.callBlackboardFunction=(t,e,i)=>{if("function"!=typeof t[this.functionName])throw`cannot call exit decorator function '${this.functionName}' is not defined in the blackboard`;t[this.functionName].call(t,t,this._fnData,{succeeded:e,aborted:i})},this.functionName=t,this._fnData=e}}e.default=r},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=o(i(2));class r extends s.default{constructor(t,e){super(),this.getFunctionName=()=>this.functionName,this.getDetails=()=>({type:this.getType(),isGuard:this.isGuard(),functionName:this.getFunctionName()}),this.callBlackboardFunction=t=>{if("function"!=typeof t[this.functionName])throw`cannot call entry decorator function '${this.functionName}' is not defined in the blackboard`;t[this.functionName].call(t,t,this._fnData)},this._fnData=e,this.functionName=t}}e.default=r}]);